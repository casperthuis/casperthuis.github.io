<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Test html</title>
    <script src="d3.js"></script>
    <script src="jquery-2.1.3.min.js"></script>
    <script src="readapi.js"></script>
    <script src="tournamentObject.js"></script>
    <script src="leastSquares.js"></script>
    <script src="math.js"></script>
    <script src="showRating.js"></script>
    <style>
    

    div.tooltip {   
      position: absolute;           
      text-align: center;           
      width: 60px;                  
      height: 28px;                 
      padding: 2px;             
      font: 12px sans-serif;        
      border: 0px;      
      border-radius: 8px;           
      pointer-events: none;         
}

</style>
</head>



<body>

<button onclick="newRow()" class="col-sm-1" class="btn btn-primary btn-sm"> New Line <span class=' glyphicon glyphicon-refresh'></span></button>

<button onclick="update()" class="col-sm-1" class="btn btn-primary btn-sm"> Update <span class=' glyphicon glyphicon-refresh'></span></button>



<div class="chart"></div>
<script>
tournament =  readAPI();
 	wMatrix = tournament.createWMatrix();
    sMatrix = tournament.createSMatrix();
    ratings = leastSquares(wMatrix,sMatrix);
    showRating(tournament.teamNames, ratings);

  wMatrixNew = tournament.createWMatrixWithRounds(4);
  sMatrixNew = tournament.createSMatrixWithRounds(4);
  ratingsround2 = leastSquares(wMatrixNew,sMatrixNew);



var linearScale = d3.scale.linear()
                    .domain([d3.min(ratingsround2), d3.max(ratingsround2)])
                    .range([0, 600]);

for (var i = 0; i < ratingsround2.length; i++) {
  ratingsround2[i] = linearScale(ratingsround2[i]);
}


var linearScale = d3.scale.linear()
                    .domain([d3.min(ratings), d3.max(ratings)])
                    .range([0, 600]);

for (var i = 0; i < ratings.length; i++) {
  ratings[i] = linearScale(ratings[i]);
}

var svg = d3.select("body").append("svg")
							.attr("width", 1500)
							.attr("height", 750);

var color = d3.scale.category20();  
var teamIndex = 10;
var i = 1;

var div = d3.select("body")
  .append("div")  // declare the tooltip div 
  .attr("class", "tooltip")              // apply the 'tooltip' class
  .style("opacity", 0); 

var group = svg.append("g")
            .attr("transform", "translate("+100*(i-1)+",0)");
                
group.transition()
  .attr("transform", "translate("+100*i+",0)")
  .delay(500);

var line = group.append("line")
                .attr("x1", 20)
                .attr("y1", 0)
                .attr("x2", 20)
                .attr("y2", 600)
                .attr("stroke-width", 3)
                .attr("stroke","dimgray")
                .attr("stroke-dasharray", 5, 5);

var line = group.append("line")
            .attr("x1", 0)
            .attr("y1", 0)
            .attr("x2", 40)
            .attr("y2", 0)
            .attr("stroke-width", 3)
            .attr("stroke","dimgray");  

var line = group.append("line")
            .attr("x1", 0)
            .attr("y1", 600)
            .attr("x2", 40)
            .attr("y2", 600)
            .attr("stroke-width", 3)
            .attr("stroke","dimgray");



circles = group.selectAll("circle")
    .data(ratings)
  .enter()
  .append("circle")
    .attr("fill", function(d,i) {return color(i)})
    .attr("stroke","black")
    .attr("cy", 0)
    .attr("opacity",function(d,i){ if(i === teamIndex){return 1;} else{ return 0.5} })
    .attr("cx", 20)
    .attr("r", 10)
    /*
    .on("click", function(d,i) {      
            div.style("opacity", .9);      
            div .html(teamNames[i])  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY ) + "px");    
            })
    */        
    .on("mouseover", function(d,i) {      
            div.transition()        
                .duration(200)      
                .style("opacity", .9);      
            div .html(teamNames[i])  
                .style("left", (d3.event.pageX) + "px")     
                .style("top", (d3.event.pageY ) + "px");    
            })
    .on("mouseout", function(d,i) {
            div.transition()
                .duration(500)
                .style("opacity", 0);
    })         
    .transition().attr("cy", function(d) {return d }).delay(900).duration(2000);          

/*

circles = group.selectAll("circle")
    .data(ratings)
  .enter()
    .append("circle")
    .attr("fill", function(d,i) {return color(i)})
    .attr("stroke","black")
    .attr("cy", 0)
    .attr("opacity",function(d,i){ if(i === teamIndex){return 1;} else{ return 0.5} })
    .attr("cx", 20)
    .attr("r", 10)
    .on("click", mouseClick)
    .transition().attr("cy", function(d) {return d }).delay(900).duration(2000);


var text = group.selectAll("text")
                        .data(ratings)
                        .enter()
                        .append("text");


var textLabels = text
                  .attr("x", 20)
                  .attr("y", 0)
                  .text( function(d,i){ return tournament.teamNames[i]})
                  .attr("font-family", "sans-serif")
                  .attr("opacity", 0.5)
                  .attr("font-size", "10px")
                  .attr("fill", "black")
                  .transition().attr("y", function(d) {return d }).delay(900).duration(2000);

 


function mouseClick() {
    d3.select(this)
    .attr("opacity", 1);
    console.log(this)
}
*/

function newRow(){

var group = svg.append("g")
            .attr("transform", "translate("+100*(i-1)+",0)");
                
group.transition()
  .attr("transform", "translate("+100*i+",0)")
  .delay(500);

var line = group.append("line")
                .attr("x1", 20)
                .attr("y1", 0)
                .attr("x2", 20)
                .attr("y2", 600)
                .attr("stroke-width", 3)
                .attr("stroke","dimgray")
                .attr("stroke-dasharray", 5, 5);

var line = group.append("line")
            .attr("x1", 0)
            .attr("y1", 0)
            .attr("x2", 40)
            .attr("y2", 0)
            .attr("stroke-width", 3)
            .attr("stroke","dimgray");  

var line = group.append("line")
            .attr("x1", 0)
            .attr("y1", 600)
            .attr("x2", 40)
            .attr("y2", 600)
            .attr("stroke-width", 3)
            .attr("stroke","dimgray");

var circle = group.selectAll("circle")
    .data(ratings)
  .enter().append("circle")
    .attr("fill", function(d,i) {return color(i)})
    .attr("cy", function(d) {return d })
    .attr("stroke","black")
    .attr("opacity",function(d,i){ if(i === teamIndex){return 1;} else{ return 0.5} })
    .attr("cx", 20)
    .attr("r", 10);
    //.transition().attr("cy", function(d) {return d }).delay(900).duration(2000);

i++;

var text = group.selectAll("text")
                        .data(ratings)
                        .enter()
                        .append("text");

var textLabels = text
                 .attr("x", 20)
                 .attr("y", 0)
                 .text( function(d,i){ return tournament.teamNames[i]})
                 .attr("font-family", "sans-serif")
                 .attr("font-size", "10px")
                 .attr("fill", "black")
                 .transition().attr("y", function(d) {return d }).delay(900).duration(2000);


}
j = 0
function update(){



 group.selectAll("circle")
              .data(ratingsround2)
              .transition()
              .attr("cy", function(d)  { return d }); 

ratings = ratingsround2               

}

/*
var linearScale = d3.scale.linear()
                    .domain([d3.min(ratings), d3.max(ratings)])
                    .range([0, 600]);


for (var i = 0; i < ratings.length; i++) {

  ratings[i] = linearScale(ratings[i]);
}

var svg = d3.select("body").append("svg")
              .attr("width", 1500)
              .attr("height", 750);


var color = d3.scale.category20();  

var teamIndex = 10;
var i = 1;

newRow();

function newRow(){


var group = svg.append("g")
            .attr("transform", "translate("+100*(i-1)+",0)");
                
group.transition()
  .attr("transform", "translate("+100*i+",0)")
  .delay(500);

var line = group.append("line")
                .attr("x1", 20)
                .attr("y1", 0)
                .attr("x2", 20)
                .attr("y2", 600)
                .attr("stroke-width", 3)
                .attr("stroke","dimgray")
                .attr("stroke-dasharray", 5, 5);

var line = group.append("line")
            .attr("x1", 0)
            .attr("y1", 0)
            .attr("x2", 40)
            .attr("y2", 0)
            .attr("stroke-width", 3)
            .attr("stroke","dimgray");  

var line = group.append("line")
            .attr("x1", 0)
            .attr("y1", 600)
            .attr("x2", 40)
            .attr("y2", 600)
            .attr("stroke-width", 3)
            .attr("stroke","dimgray");

var circle = group.selectAll("circle")
    .data(ratings)
  .enter().append("circle")
    .attr("fill", function(d,i) {return color(i)})
    .attr("stroke","black")
    .attr("cy", 0)
    .attr("opacity",function(d,i){ if(i === teamIndex){return 1;} else{ return 0.5} })
    .attr("cx", 20)
    .attr("r", 10)
    .transition().attr("cy", function(d) {return d }).delay(900).duration(2000);

Newratings = math.add(ratings, 10);

i++;

var text = group.selectAll("text")
                        .data(ratings)
                        .enter()
                        .append("text");

var textLabels = text
                 .attr("x", 20)
                 .attr("y", 0)
                 .text( function(d,i){ return tournament.teamNames[i]})
                 .attr("font-family", "sans-serif")
                 .attr("font-size", "10px")
                 .attr("fill", "black")
                 .transition().attr("y", function(d) {return d }).delay(900).duration(2000);


}
*/



</script>


</body>
</html>
