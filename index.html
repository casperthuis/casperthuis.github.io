<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Index</title>
    <script src="jquery-2.1.3.min.js"></script>
    <script scr="readScore.js" charset="utf-8"> </script>
    <script src="test2.js" type="text/javascript"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/mathjs/1.6.0/math.min.js" type="text/javascript"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>


</head>
<body onload"readScores()">
    <div id="window"></div>
    <ul id="list">

    </ul>
    <script>

    var scores = {};
        $.ajax({
        url: "test.json",
        beforeSend: function(xhr){
            if (xhr.overrideMimeType)
            {
                xhr.overrideMimeType("application/json");
            }
        },
        async: false,
        dataType: 'json',
        success: function(data) {
            scores = data;
        }
    });
        //console.log(scores);

    var wMatrix = {};    
        $.ajax({
        url: "wmatrix.json",
        beforeSend: function(xhr){
            if (xhr.overrideMimeType)
            {
                xhr.overrideMimeType("application/json");
            }
        },
        async: false,
        dataType: 'json',
        success: function(data) {
            wMatrix = data;
        }
    });
        //console.log(wMatrix);

    var teamnames = {};    
        $.ajax({
        url: "teamnames.json",
        beforeSend: function(xhr){
            if (xhr.overrideMimeType)
            {
                xhr.overrideMimeType("application/json");
            }
        },
        async: false,
        dataType: 'json',
        success: function(data) {
            teamnames = data.teamnames;
        }
    });
            

    console.log(teamnames)        

    function leastsquares(wMatrix,scores){
        //console.log(scores);
        //console.log(wMatrix);
        var scoresarray = new Array((scores.games.length/2)); 
        //console.log(scores.games[0])
        //console.log(scores.games[1])
        //console.log(Math.abs(scores.games[1]-scores.games[2]));
        var j = 0;
        for (var i = 0; i < (scores.games.length); i = i + 2){
            
           //console.log(Math.abs(scores.games[i]-scores.games[i+1]));
           scoresarray[j] =  Math.abs(scores.games[i]-scores.games[i+1]);
           j++;
        };
        
        
        
        var wTranspose = math.transpose(wMatrix.wMatrix);
        
       
        
        
        wTranspose = math.matrix(wTranspose);
        //scoresarray = math.matrix(scoresarray);
        //console.log(math.size(wTranspose)); // array 40 by 160
        //console.log(math.size(scoresarray)); // Is nu 1 * 160 moet 160 * 1 zijn.


       
        var size = wTranspose.size();
        var wTransposeArray = wTranspose.valueOf();
       

  
        var sum = 0;
        yVector = new Array();
        for(var i = 0; i < size[0]-1;i++){
            for(var j = 0;j < scoresarray.length;j++){
                //console.log(j);
                //console.log(wTransposeArray[i][j])
                //console.log(scoresarray[j])
                sum = sum + wTransposeArray[i][j]*scoresarray[j];
            }
            yVector[i] = sum;
            sum = 0;   
        }
        


        var xMatrix = math.multiply(wTranspose, wMatrix.wMatrix);    
        // console.log(yVector);
        // console.log(xMatrix);
        // Voeg rij nullen toe
        yVector[yVector.length] = 0;
    
        
        // Voeg rij eenen toe
        xMatrix = xMatrix.valueOf(); 
        for(var i = 0; i < size[0];i++){
            xMatrix[(size[0]-1)][i] = 1;
        }
        

        //

        // X\y of least squares of inverse
        // console.log(xMatrix);
        // console.log(math.inv(xMatrix))
        inv = math.inv(xMatrix);
        // console.log(math.multiply(inv,yVector));

        return math.multiply(inv,yVector);


    };

    ratings = leastsquares(wMatrix,scores);
    for(i = 0; i < teamnames.length; i++){
    var node = document.createElement("LI");
    var textNode = document.createTextNode(teamnames[i]);
    node.appendChild(textNode);
    var ratingNode = document.createTextNode(" " + Math.round(ratings[i]*10)/10);
    node.appendChild(ratingNode);
    document.getElementById("list").appendChild(node);
    }   
    </script>
</body>
</html>